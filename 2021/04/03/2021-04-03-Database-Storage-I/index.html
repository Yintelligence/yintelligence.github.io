<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Database Storage I, Chaoqun Yin">
    <meta name="description" content="Veni, Vidi, Vici">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Database Storage I | Chaoqun Yin</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.3.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Chaoqun Yin</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>Contact</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>Friends</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Chaoqun Yin</div>
        <div class="logo-desc">
            
            Veni, Vidi, Vici
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			Friends
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/7.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Database Storage I</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Database-systems/">
                                <span class="chip bg-color">Database systems</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Database/" class="post-category">
                                Database
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2021-04-03
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp;
                    2021-04-04
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    2.9k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>Read Times:&nbsp;&nbsp;
                    18 Min
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="database-storage-i">Database Storage I</h1>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=1D81vXw2T_w&amp;list=PLSE8ODhjZXjbohkNBWQs_otTrBTrjyohi&amp;index=4">Video</a></p>
<p><a target="_blank" rel="noopener" href="https://15445.courses.cs.cmu.edu/fall2019/notes/03-storage1.pdf">Lecture Notes</a> + <a target="_blank" rel="noopener" href="https://15445.courses.cs.cmu.edu/fall2019/slides/03-storage1.pdf">Slides</a></p>
<p><a target="_blank" rel="noopener" href="https://xiaotaoguo.com/CMU-DB-4-database-storage-1/">参考</a></p>
<p>In this course, we will learn how to build software that manages a database.</p>
<p><img src="/images/DB/16001600.png" /></p>
<h2 id="storage-537">Storage 5:37</h2>
<p>We will focus on a “disk-oriented” DBMS architecture that <u>assumes that primary storage location of the database is on non-volatile disk</u>.</p>
<p>At the top of the storage hierarchy you have the devices that are closest to the CPU. This is the fastest storage but it is also the smallest and most expensive. The further you get away from the CPU, the storage devices have larger the capacities but are much slower and farther away from the CPU. These devices also get cheaper per GB.</p>
<p><strong>Volatile Devices:</strong></p>
<ul>
<li>Volatile means that if you pull the power from the machine, then the data is lost.</li>
<li>Volatile storage supports <strong>fast random access</strong> with <strong>byte-addressable locations</strong>. This means that the program can jump to any byte address and get the data that is there.</li>
<li>For our purposes, we will always refer to this storage class as “<strong><em>memory</em></strong>”.</li>
</ul>
<p><strong>Non-Volatile Devices:</strong></p>
<ul>
<li>Non-volatile means that the storage device does not need to be provided continuous power in order for the device to retain the bits that it is storing.</li>
<li>It is also <strong>block/page addressable</strong>. This means that in order to read a value at a particular offset, the program first has to load the 4 KB page into memory that holds the value the program wants to read.</li>
<li>Non-volatile storage is traditionally better at <strong>sequential access</strong> (reading multiple chunks of data at the same time).</li>
<li>We will refer to this as “<strong><em>disk</em></strong>”. We will not make a (major) distinction between solid-state storage (SSD) or spinning hard drives (HDD).</li>
</ul>
<p><img src="/images/DB/1106300.png" /></p>
<blockquote>
<p>There is also a new class of storage devices that are coming out soon called <em>non-volatile memory</em>. These devices are designed to be the best of both worlds: almost as fast as DRAM but with the persistence of disk. We will not cover these devices.</p>
</blockquote>
<p>Since the system assumes that the database is stored on disk, the components of the DBMS are responsible for figuring out how to move the data back and forth from the non-volatile disk and volatile memory, since the system <strong>cannot operate on the data directly on disk</strong>.</p>
<p>We will focus on <strong>how we can hide the latency of the disk</strong> rather than focusing on optimizations with registers and caches, since getting data from disk is so slow. If reading data from the L1 cache reference took half a second, then reading from an SSD would take 1.7 days and reading from an HDD would take 16.5 weeks.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">0.5 ns</th>
<th>L1 Cache Ref</th>
<th>0.5 sec</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">7 ns</td>
<td>L2 Cache Re</td>
<td>7 sec</td>
</tr>
<tr class="even">
<td style="text-align: right;">100 ns</td>
<td>DRAM</td>
<td>100 sec</td>
</tr>
<tr class="odd">
<td style="text-align: right;">150,000 ns</td>
<td>SSD</td>
<td>1.7 days</td>
</tr>
<tr class="even">
<td style="text-align: right;">10,000,000 ns</td>
<td>HDD</td>
<td>16.5 weeks</td>
</tr>
<tr class="odd">
<td style="text-align: right;">~30,000,000 ns</td>
<td>Network Storage</td>
<td>11.4 months</td>
</tr>
<tr class="even">
<td style="text-align: right;">1,000,000,000 ns</td>
<td>Tape Archives</td>
<td>31.7 years</td>
</tr>
</tbody>
</table>
<h2 id="system-design-goals-1401">System design goals 14:01</h2>
<ul>
<li>Allow the DBMS to manage databases that exceed the amount of memory available.</li>
<li>Reading/writing to disk is expensive, so it must be managed carefully to avoid large stalls and performance degradation.</li>
</ul>
<h2 id="disk-oriented-dbms-overview">Disk-Oriented DBMS Overview</h2>
<p>The database is all on disk, and the data in the database files is organized into pages, and the first page is the directory page.</p>
<p>In order to operate on the data the DBMS needs to <strong>bring the data into memory</strong>. It does this by having a <strong><em>buffer pool</em></strong> that manages the movement back and forth between disk and memory.</p>
<p>The DBMS also have an <strong>execution engine</strong> that will execute queries. The execution engine will ask the buffer pool for a specific page, and the buffer pool will take care of bringing that page into memory and giving the execution engine a pointer to the page in memory. The buffer pool manager will ensure that the page is there while the execution engine is operating on that memory.</p>
<figure>
<img src="/images/DB/1106301.png" alt="" /><figcaption>Disk-Oriented DBMS</figcaption>
</figure>
<blockquote>
<p>First, the processor sends a request to obtain certain data. But there is no such data in the memory, it needs to be read from the disk, read and re-file pointers to the processor, and then the processor performs calculations. The database is responsible for the data transfer and does not need to care what computation the processor will do.</p>
</blockquote>
<h2 id="dbms-vs.-os">DBMS vs. OS</h2>
<p>From the above diagram and goals, we need to manage data larger than the actual memory space, so why not directly use the virtual memory mechanism of the operating system and let the operating system manage the read and write operations or manually read the memory and disk every time?</p>
<p><img src="/images/DB/1106302.png" /></p>
<ul>
<li>One can use memory mapping (<strong>mmap</strong>) to store the contents of a file into a process' address space.</li>
<li>The OS is responsible for moving data for moving the files' pages in and out of memory.</li>
</ul>
<blockquote>
<p>The principle of virtual memory is roughly as shown in the figure : the operating system maintains a virtual address list (memory-mapping, mmap).</p>
<p>Every time a page needs to be retrieved, it will first check whether it is stored in the memory. If not, read it from the disk, otherwise visit directly.</p>
<p>But when the actual memory is full of data, the operating system needs to decide which page to clear. At this time, if you directly let the operating system choose, you cannot make an efficient choice based on the nature of the database.</p>
<p>The operating system choice is not good.</p>
</blockquote>
<p>A high-level design goal of the DBMS is to support databases that exceed the amount of memory available. Since reading/writing to disk is expensive, it must be managed carefully. We do not want large stalls from fetching something from disk to slow down everything else. So we want the DBMS to be able to process other queries while it is waiting to get the data from disk.</p>
<p>This high-level design goal is like virtual memory, where there is a large address space and a place for the OS to bring in pages from disk.</p>
<p>One way to achieve this virtual memory, is by using mmap to map the contents of a file in a process address space, which makes the OS responsible for moving pages back and forth between disk and memory. Unfortunately, this means that if mmap hits a page fault, this will block the process.</p>
<ul>
<li>You never want to use mmap in your DBMS if you need to write.</li>
<li>The DBMS (almost) always wants to control things itself and can do a better job at it since it knows more about the data being accessed and the queries being processed.</li>
<li>The operating system is not your friend.</li>
</ul>
<p>What if we allow multiple threads to access the <strong>mmap</strong> files to hide page fault stalls?</p>
<ul>
<li>This works good enough for read-only access.</li>
<li>But it is complicated when there are multiple writers…</li>
</ul>
<p>It is possible to use the OS by using:</p>
<ul>
<li>madvise: Tells the OS know when you are planning on reading certain pages.</li>
<li>mlock: Tells the OS to not swap memory ranges out to disk.</li>
<li>msync: Tells the OS to flush memory ranges out to disk</li>
</ul>
<p><strong>We do not advise using mmap in a DBMS for correctness and performance reasons</strong>. Even though the system will have functionalities that seem like something the OS can provide, Having the DBMS implement these procedures itself gives it better control and performance.</p>
<h2 id="database-storage">Database storage</h2>
<ul>
<li><strong>Problem #1: How the DBMS represents the database in files on disk.</strong> (This part)
<ul>
<li>File Storag</li>
<li>Page Layout</li>
<li>Tuple Layout</li>
</ul></li>
<li>Problem #2: How the DBMS manages its memory and move data back-and-forth from disk. (Part 2)</li>
</ul>
<h3 id="file-storage">File Storage</h3>
<p>In its most basic form, a DBMS stores a database as files on disk. Some may use a file hierarchy, others may use a single file (e.g., SQLite).</p>
<p>The OS does not know anything about the contents of these files. Only the DBMS knows how to decipher their contents, since it is encoded in a way specific to the DBMS.</p>
<p>The DBMS’s storage manager is responsible for managing a database’s files. It represents the files as a collection of pages. It also keeps track of what data has been read and written to pages, as well how much free space there is in the pages.</p>
<ul>
<li>The DBMS stores a database as one or more files on disk.
<ul>
<li>The OS doesn't know anything about the contents of these files.</li>
</ul></li>
<li>Early systems in the 1980s used custom filesystems on raw storage.
<ul>
<li>Some "enterprise" DBMSs still support this.</li>
<li>Most newer DBMSs do not do this.</li>
</ul></li>
</ul>
<h4 id="storage-manager">Storage manager</h4>
<p>It represents the files as a collection of pages. It also keeps track of what data has been read and written to pages, as well how much free space there is in the pages.</p>
<p>The <u>storage manager</u> is responsible for maintaining a database's files.</p>
<ul>
<li>Some do their own scheduling for reads and writes to improve spatial and temporal locality of pages.</li>
</ul>
<p>It organizes the files as a collection of pages.</p>
<ul>
<li>Tracks data read/written to pages.</li>
<li>Tracks the available space.</li>
</ul>
<h4 id="database-pages">Database Pages</h4>
<p>The DBMS organizes the database across one or more files in fixed-size blocks of data called <strong><em>pages</em></strong>.</p>
<ul>
<li><p>A page is a fixed-size block of data.</p>
<ul>
<li><p>It can contain tuples, meta-data, indexes, log records…</p></li>
<li><p>Most systems do not mix page types.</p></li>
<li><p>Some systems require a page to be self-contained.</p>
<blockquote>
<p>Meaning that all the information needed to read each page is on the page itself !</p>
<p>This is mainly for data security. Assuming we have a table, we put the header in one page and all the tuples in another page. At this time, if the disk is damaged, the page with the header cannot be read. This will cause the page containing the tuple to fail to function.</p>
</blockquote></li>
</ul></li>
<li><p>Each page is given a unique identifier.</p>
<blockquote>
<p>In this way, when the storage location changes, the manager does not need to change the id of the page, but only needs to change the address of the mapping.</p>
</blockquote>
<ul>
<li>If the database is a single file, then the page id can just be the file offset.</li>
<li>The DBMS uses an indirection layer to map page ids to physical locations</li>
</ul></li>
</ul>
<p>Most DBMSs have an indirection layer that maps a page id to a file path and offset. The upper levels of the system will ask for a specific page number and then the storage manager will have to turn that page number into a file and an offset to find the page.</p>
<p>Most DBMSs uses fixed-size pages to avoid the engineering overhead needed to support variable-sized pages. For example, with variable-size pages, deleting a page could create a hole in files that the DBMS cannot easily fill with new pages.</p>
<p>There are three different notions of "pages" in a DBMS:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Hardware Page</th>
<th style="text-align: left;">usually 4KB</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">OS Page</td>
<td style="text-align: left;">usually 4KB</td>
</tr>
<tr class="even">
<td style="text-align: left;">Database Page</td>
<td style="text-align: left;">512B-16KB</td>
</tr>
</tbody>
</table>
<p>The storage device guarantees an atomic write of the size of the hardware page. If the hardware page is 4 KB, then when the system tries to write 4 KB to the disk, either all 4 KB will be written, or none of it will. This means that if our database page is larger than our hardware page, the DBMS will have to take extra measures to ensure that the data gets written out safely since the program can get partway through writing a database page to disk when the system crashes.</p>
<h4 id="page-storage-architecture">Page storage architecture</h4>
<p>Different DBMSs manage pages in files on disk in different ways.</p>
<ul>
<li>Heap File Organization</li>
<li>Sequential / Sorted File Organization</li>
<li>Hashing File Organization</li>
</ul>
<blockquote>
<p>We would focus on the Heap File Organization. At this point in the hierarchy we don't need to know anything about what is inside of the pages.</p>
</blockquote>
<h4 id="database-heap">Database Heap</h4>
<p>There are a couple ways to find the location of the page a DBMS wants on the disk, and a heap file organization is one of the ways.</p>
<p>A <strong><em>heap file</em></strong> is an unordered collection of pages where tuples are stored in random order.</p>
<ul>
<li>Create / Get / Write / Delete Page</li>
<li>Must also support iterating over all pages.</li>
<li>Need meta-data to keep track of what pages exist and which ones have free space.</li>
</ul>
<p>The DBMS can locate a page on disk given a page id by using a linked list of pages or a page directory.</p>
<ol type="1">
<li><p><strong>Linked List</strong>: Header page holds pointers to to a list of free pages and a list of data pages. However, if the DBMS is looking for a specific page, it has to do a sequential scan on the data page list until it finds the page it is looking for.</p>
<blockquote>
<p>Currently less used</p>
</blockquote></li>
<li><p><strong>Page Directory</strong>: DBMS maintains special pages that track locations of data pages along with the amount of free space on each page.</p></li>
</ol>
<h5 id="linked-list">Linked List</h5>
<p>Maintain a <u>header page</u> at the beginning of the file that stores two pointers:</p>
<ul>
<li>HEAD of the <u>free page list</u>.</li>
<li>HEAD of the <u>data page list</u>.</li>
</ul>
<p>Each page keeps track of the number of free slots in itself.</p>
<p><img src="/images/DB/1106303.png" /></p>
<h5 id="page-directory">Page Directory</h5>
<p>The DBMS maintains special pages that tracks the location of data pages in the database files.</p>
<p>The directory also records the number of free slots per page.</p>
<p>The DBMS has to <strong>make sure</strong> that the directory pages are in sync with the data pages.</p>
<blockquote>
<p>We need to consider what mechanism will enable the page directory to continue to synchronize when the system crashes during the page directory update process</p>
</blockquote>
<p><img src="/images/DB/1106304.png" /></p>
<h3 id="page-layout">Page Layout</h3>
<p>Every page includes a <strong>header</strong> that records meta-data about the page’s contents:</p>
<ul>
<li><p>Page size.</p></li>
<li><p>Checksum.</p></li>
<li><p>DBMS version.</p></li>
<li><p>Transaction visibility.</p></li>
<li><p>Some systems require pages to be self-contained (e.g oracle).</p>
<blockquote>
<p>Some systems require pages to be selfcontained (e.g., Oracle).</p>
</blockquote></li>
</ul>
<p><img src="/images/DB/1106305.png" /></p>
<p>For any page storage architecture, we now need to understand how to organize the data stored inside of the page.</p>
<blockquote>
<p>We are still assuming that we are only storing tuples.</p>
</blockquote>
<p>Two approaches:</p>
<ul>
<li>Tuple-oriented</li>
<li>Log-structured</li>
</ul>
<h4 id="tuple-oriented">Tuple-oriented</h4>
<h5 id="strawman-approach">Strawman approach</h5>
<p>A strawman approach to laying out data is to keep track of how many tuples the DBMS has stored in a page and then every time it adds a new tuple, it appends the tuple to the end. However, problems arise when it deletes a tuple or when the tuples have variable-length attributes.</p>
<blockquote>
<p>The efficiency is relatively low, so it is seldom used at present</p>
</blockquote>
<p><img src="/images/DB/1106306.png" /></p>
<h5 id="slotted-pages">Slotted Pages</h5>
<p>The slot array maps "slots" to the tuples' starting position offsets.</p>
<ul>
<li>Most common approach used in DBMSs today.</li>
<li>Divide to parts
<ul>
<li>Header keeps track of <u>the number of used slots</u> and the offset of the starting location of last used slot and a slot array, which keeps track of <u>the location of the start of each tuple</u>.</li>
<li>To add a tuple, <em>the slot array</em> will <u>grow from the beginning to the end</u>, and <em>the data of the tuples</em> will <u>grow from end to the beginning</u>. The page is considered full when the slot array and the tuple data meet</li>
</ul></li>
</ul>
<p><img src="/images/DB/1106307.png" /></p>
<p><img src="/images/DB/1106308.png" /></p>
<h4 id="log-structured">Log-Structured</h4>
<p>Instead of storing tuples, the DBMS <strong>only stores log records</strong>.</p>
<blockquote>
<p>Stores records to file of how the database was modified</p>
<ul>
<li>Inserts store the entire tuple.</li>
<li>Deletes mark the tuple as deleted.</li>
<li>Updates contain the delta of just the attributes that were modified.</li>
</ul>
</blockquote>
<p><img src="/images/DB/1106309.png" /></p>
<p>To read a record, the DBMS scans the log file backwards and “recreates” the tuple.</p>
<p><img src="/images/DB/1106310.png" /></p>
<ul>
<li>Advantage
<ul>
<li>Easy to roll back</li>
<li>Fast write speed</li>
<li>Works well on append-only storage because the DBMS cannot go back and update the data.</li>
</ul></li>
<li>Disadvantage
<ul>
<li>Potentially slow reads</li>
</ul></li>
</ul>
<p><strong>Optimization</strong></p>
<p>To avoid long reads the DBMS can have indexes to allow it to jump to specific locations in the log.</p>
<p><img src="/images/DB/1106311.png" /></p>
<p>It can also periodically compact the log (if it had a tuple and then made an update to it, it could compact it down to just inserting the updated tuple). The issue with compaction is the DBMS ends up with write amplification (it re-writes the same data over and over again).</p>
<p><img src="/images/DB/1106312.png" /></p>
<h3 id="tuple-layout">Tuple Layout</h3>
<p>A tuple is essentially a sequence of bytes. It is DBMS’s job to interpret those bytes into attribute types and values.</p>
<h4 id="tuple-header">Tuple Header</h4>
<p>Each tuple is prefixed with a <strong>header</strong> that contains <strong>meta-data</strong> about it.</p>
<ul>
<li>Visibility information for the DBMS’s concurrency control protocol (i.e., information about which transaction created/modified that tuple).</li>
<li>Bit Map for <strong>NULL</strong> values.</li>
<li>Note that the DBMS <strong>does not</strong> need to store meta-data about the schema.</li>
</ul>
<h4 id="tuple-data">Tuple Data</h4>
<p>Actual data for attributes.</p>
<ul>
<li>Attributes are typically stored in the order that you specify them when you create the table.</li>
<li>Most DBMSs do not allow a tuple to exceed the size of a page.</li>
</ul>
<h4 id="denormalized-tuple-data">Denormalized Tuple Data</h4>
<p>If two tables are related, the DBMS can deformalize (“pre-join”) them, so the tables end up on the same page.</p>
<ul>
<li>Potentially reduces the amount of I/O for common workload patterns.</li>
<li>Can make updates more expensive.</li>
</ul>
<p>As shown in the figure below, there is a foreign key in the bar pointing to foo, and denormalization can put their headers together in advance.</p>
<blockquote>
<p>This approach is seldom used now. Generally, tuples of different tables have different pages.</p>
</blockquote>
<p><img src="/images/DB/1106313.png" /></p>
<p><img src="/images/DB/1106314.png" /></p>
<p>Not a new idea.</p>
<ul>
<li>IBM System R did this in the 1970s.</li>
<li>Several NoSQL DBMSs do this without calling it physical denormalization</li>
</ul>
<h4 id="record-id">Record id</h4>
<ul>
<li>Each tuple in the database is assigned a unique identifier.</li>
<li>Most common: <strong>page id + (offset or slot)</strong>.</li>
<li>An application <strong>cannot</strong> rely on these ids to mean anything.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<ul>
<li>Database is organized in pages.</li>
<li>Different ways to track pages.</li>
<li>Different ways to store pages.</li>
<li>Different ways to store tuples.</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Chaoqun Yin</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://yintelligence.tech/2021/04/03/2021-04-03-Database-Storage-I/">https://yintelligence.tech/2021/04/03/2021-04-03-Database-Storage-I/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint polocy. If reproduced, please indicate source
                    <a href="/about" target="_blank">Chaoqun Yin</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Database-systems/">
                                    <span class="chip bg-color">Database systems</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/2021/04/03/2021-04-03-Asymptotics-I/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/0.jpg" class="responsive-img" alt="">
                        
                        <span class="card-title"></span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-04-03
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Chaoqun Yin
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/04/02/2021-04-02-Programming-in-the-Real-World/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/13.jpg" class="responsive-img" alt="Programming in the Real World">
                        
                        <span class="card-title">Programming in the Real World</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2021-04-02
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Notes/" class="post-category">
                                    Notes
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Data-Structures/">
                        <span class="chip bg-color">Data Structures</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + 'From: Chaoqun Yin<br />'
            + 'Author: Chaoqun Yin<br />'
            + 'Link: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">Chaoqun Yin</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2021";
                    var startMonth = "1";
                    var startDate = "28";
                    var startHour = "2";
                    var startMinute = "1";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/yintelligence" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:Yintelligence@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

	
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
